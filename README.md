# 1 Upcalls from kernel strategy demo
### Introduction
This is the code for 3.1 using upcalls from kernel.
User mode helper API is used.

### Execute
Copy this directory to Linux. Execute shell `make` and **test.ko** will be generated.
Install this driver by executing `sudo insmod test.ko` and init function is called.
<br>A **test.txt** file will be generated by kernel thread under **/root/**.
<br>`dmesg` can show logs.

### Uninstall
`sudo rmmod test` and the txt will be removed.

### Logs
```shell
[  352.909355] call_usermodehelper module isstarting..!
[  352.912332] ret=0
```
# 2 Cases
## Case 1: Exception Handling
### Introduction
The code for Case 1.

### Execute and Uninstall
First use `gcc` to compile **exception.c**, and move **a.out** under **/root/**.
Other instructions are similar to the above.

### Output
```shell
[ 4127.789378] ret=136
[ 4127.789380] call_usermodehelper module isstarting..!
[ 4127.789760] traps: a.out[7636] trap divide error ip:55d6e41ac609 sp:7ffcec177170 error:0 in a.out[55d6e41ac000+1000]
[ 4127.989541] ret=136
[ 4127.989543] call_usermodehelper module isstarting..!
[ 4127.989950] traps: a.out[7638] trap divide error ip:55c45a809609 sp:7ffe1cfc5e70 error:0 in a.out[55c45a809000+1000]
[ 4128.174340] ret=136
[ 4128.174341] call_usermodehelper module isstarting..!
[ 4128.174742] traps: a.out[7640] trap divide error ip:559ea3943609 sp:7ffda6a19dc0 error:0 in a.out[559ea3943000+1000]
```

## Case 2: Data Synchronization
### Introduction
The code for case 2. Using multiple sub processes to call `sync()` to increase kernel threads' workload.

### Execute
Use gcc to compile **t.c** and execute `./a.out`.
<br>Many temp files are generated.

### Output
```shell
Sync attack completed.
Sync attack completed.
Sync attack completed.
```

## Case 3: System Process - Journald
### Introduction
The code for case 3. Using journal to increase kernel thread workload.

### Execute
Use gcc to compile **t.c** and execute `./a.out`.
<br>Many temp files are generated.

### Output
```shell
Switching user...
Adding user/group...
Triggering sync...
Triggering exception...
Segmentation fault (core dumped)
```

## Case 4: Container Engine
### Introduction and Execute
1. First install docker.
<br>`sudo apt-get install docker-ce docker-ce-cli containerd.io`
2. Use **Dockerfile** to build an image (execute below shell in the same directory as Dockerfile).
<br>`docker build -t docker-cli-container .`
3. Run and enter the container.
<br>`docker run -it --rm basic-container`
4. Execute the **workload.sh** in the container to simulate the workload to Docker engine.

## Case 5: Softirq Handling
### Introduction and Execute
Use `fio` to simulate BLOCK softirq.
1. Enter the above container.
2. First install fio.
    ```shell
    apt-get update
    apt-get install fio
    ```
3. Execute `fio test.fio`
---
According to Internet and ChatGPT.